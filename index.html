<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>膜厚單位換算器 Thickness Unit Converter</title>
  <style>
    body{font-family:"微軟正黑體",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#f4f8fc;margin:0;padding:24px;display:flex;justify-content:center}
    .wrap{width:min(760px,100%);background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.08);padding:20px}
    h1{margin:0 0 8px;text-align:center;color:#317EFB;font-size:1.5rem}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .sub{color:#6b7280;text-align:center;margin:0 auto 12px}
    .grid{display:grid;gap:14px}
    @media (min-width:680px){.grid{grid-template-columns:1fr 1fr}}
    .row{display:flex;flex-direction:column;gap:6px}
    label{font-weight:600}
    input{padding:12px;border:1px solid #e5e7eb;border-radius:10px;font-size:1.05rem}
    input:focus{outline:none;border-color:#317EFB;box-shadow:0 0 0 3px rgba(49,126,251,.15)}
    .hint{font-size:.9rem;color:#6b7280}
    .btn{padding:8px 12px;border:1px solid #317EFB;background:#eaf2ff;color:#1b59c7;border-radius:10px;cursor:pointer}
    .btn:active{transform:scale(.98)}
  </style>
</head>
<body>
  <form class="wrap" autocomplete="off" autocapitalize="off" spellcheck="false">
    <div class="topbar">
      <h1 style="margin:0;">📏 膜厚單位換算器｜Thickness Unit Converter</h1>
      <button type="button" id="demo" class="btn" title="填入示範值">填入示範值</button>
    </div>
    <p class="sub">五欄任填，其他自動同步｜Enter any field, others update automatically</p>

    <div class="grid">
      <!-- 1. µm -->
      <div class="row">
        <label for="um">µm（微米 / micrometer）</label>
        <input id="um" name="um" type="text" inputmode="decimal" autocomplete="off" placeholder="e.g. 20">
        <div class="hint">基準單位 Base unit</div>
      </div>

      <!-- 2. µ”in -->
      <div class="row">
        <label for="uin">µ”in（微英吋 / microinch）</label>
        <input id="uin" name="uin" type="text" inputmode="decimal" autocomplete="off" placeholder="e.g. 335.43">
        <div class="hint">1 µm = 1,000,000 / 25,400 ≈ 39.37007874 µ”in</div>
      </div>

      <!-- 3. inch -->
      <div class="row">
        <label for="inch">inch（英吋 / inch）</label>
        <input id="inch" name="inch" type="text" inputmode="decimal" autocomplete="off" placeholder="e.g. 0.0008">
        <div class="hint">1 inch = 25,400 µm（exact）</div>
      </div>

      <!-- 4. 條 -->
      <div class="row">
        <label for="strip">條（strip）</label>
        <input id="strip" name="strip" type="text" inputmode="decimal" autocomplete="off" placeholder="e.g. 2.54">
        <div class="hint">1 條 = 10 µm</div>
      </div>

      <!-- 5. mm（放最後） -->
      <div class="row">
        <label for="mm">mm（公釐 / millimeter）</label>
        <input id="mm" name="mm" type="text" inputmode="decimal" autocomplete="off" placeholder="e.g. 0.02">
        <div class="hint">1 mm = 1000 µm</div>
      </div>
    </div>
  </form>

  <script>
    // —— 常數（相容寫法）——
    var UM_PER_MM      = 1000;                 // µm per mm
    var UM_PER_INCH    = 25400;                // µm per inch (exact)
    var MICROIN_PER_UM = 1000000 / UM_PER_INCH;// µ" in per µm
    var UM_PER_STRIP   = 10;                   // µm per 條
    var DECIMALS       = 5;

    function $(id){ return document.getElementById(id); }
    var el = { um:$('um'), uin:$('uin'), inch:$('inch'), strip:$('strip'), mm:$('mm') };

    function toNumber(raw){
      if (typeof raw !== 'string') raw = String(raw == null ? '' : raw);
      // 移除逗號/空白、全形數字轉半形
      raw = raw.replace(/[, \t\r\n]/g,'').replace(/[０-９．]/g,function(ch){ return ch==='．'?'.':String.fromCharCode(ch.charCodeAt(0)-0xFF10+0x30); });
      var n = Number(raw);
      return isFinite(n) ? n : NaN;
    }
    function fmt(n){
      if (!isFinite(n)) return '';
      var s = n.toFixed(DECIMALS);
      s = s.replace(/(\.\d*?[1-9])0+$/,'$1').replace(/\.0+$/,'').replace(/\.$/,'');
      return s;
    }

    function fillFromUm(um){
      el.um.value    = fmt(um);
      el.uin.value   = fmt(um * MICROIN_PER_UM);
      el.inch.value  = fmt(um / UM_PER_INCH);
      el.strip.value = fmt(um / UM_PER_STRIP);
      el.mm.value    = fmt(um / UM_PER_MM);
    }

    function toUm(which, v){
      if (which === 'um')   return v;
      if (which === 'uin')  return v * 0.0254;     // 1 µ" in = 0.0254 µm
      if (which === 'inch') return v * UM_PER_INCH;
      if (which === 'strip')return v * UM_PER_STRIP;
      if (which === 'mm')   return v * UM_PER_MM;
      return NaN;
    }

    var updating = false;
    function handle(which){
      if (updating) return;
      updating = true;
      var v = toNumber(el[which].value);
      if (isFinite(v)) {
        fillFromUm(toUm(which, v));
        // 保留正在輸入欄位的原字串（避免游標跳動）
        el[which].value = el[which].value;
      } else {
        // 若輸入無效，不同步，但也不覆蓋其他欄位
      }
      updating = false;
    }

    function bindAll(){
      ['um','uin','inch','strip','mm'].forEach(function(k){
        ['input','change','keyup','paste','blur'].forEach(function(ev){
          el[k].addEventListener(ev, function(){ handle(k); });
        });
      });
    }

    function clearAll(){
      Object.keys(el).forEach(function(k){ el[k].value = ''; });
    }

    // DOM 就緒 → 綁定 + 清空（不再自動填預設值）
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function(){ bindAll(); clearAll(); });
    } else {
      bindAll(); clearAll();
    }

    // 提供手動示範按鈕
    $('demo').addEventListener('click', function(){
      fillFromUm(20); // 手動示範：20 µm
    });
  </script>
</body>
</html>
